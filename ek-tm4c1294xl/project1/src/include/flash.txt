/*------------------------------------------------------------------------------
FLASH.H

 Ќастройки флэш-пам€ти
------------------------------------------------------------------------------*/

#ifndef __FLASH
#define __FLASH


// размер страницы
#define wPAGE_SIZE      528

// размер страницы, доступный дл€ записи данных пользовател€
#define wFREEPAGE_SIZE  512

// количество страниц
#define wPAGES          8192


// количество повторов при чтении регистра состо€ни€ (TODO: use milliseconds)
#define wREAD_STATUS    50000

// количество повторов при чтени€/записи страницы
#define bMAXREPEAT      8


// количество страниц на блок данных определЄнного типа (TODO rename IMPCAN_PAGES etc.)
#define bIMPULSE_CAN    (uchar)(sizeof(impulse) * bCANALS/wFREEPAGE_SIZE + 1)
#define bPOWER_GRP      (uchar)(sizeof(power)   * bGROUPS/wFREEPAGE_SIZE + 1)
#define REALCAN_PAGES   (uchar)(sizeof(real)    * bCANALS/wFREEPAGE_SIZE + 1)


// количество страниц дл€ графика профилей по получасам
#ifdef  DAYS100

#define IMPHOUCAN_PAGES (uint)(wHOURS/4)

#else

#define IMPHOUCAN_PAGES (uint)(wHOURS/1)
#define UINTCAN_PAGES   (uchar)(sizeof(uint)    * bCANALS/wFREEPAGE_SIZE + 1)

#endif


// адреса блоков данных
typedef enum
{
BEGIN(FLS_BEGIN, 0)

RESERVE(FLS_PRIVATE, 1)
RESERVE(FLS_GLOBAL, 1)
RESERVE(FLS_LOGICAL, 1)

RESERVE(FLS_PORTS, 1)

RESERVE(FLS_GROUPS, sizeof(group)*bGROUPS/wFREEPAGE_SIZE + 1)

RESERVE(FLS_PUBLIC_TARIFFS, 1)
RESERVE(FLS_TARIFFS_MODE, 1)

RESERVE(FLS_DAY_ZONE, 1)

RESERVE(FLS_ZONES_POW, 12*bMODES)
RESERVE(FLS_ZONES_ENG, 12*bMODES)

RESERVE(FLS_PERIOD_POW, 1)
RESERVE(FLS_PERIOD_ENG, 1)

RESERVE(FLS_RELAXS_FLAG, 1)
RESERVE(FLS_RELAXS_TARIFF, 1)
RESERVE(FLS_RELAXS, sizeof(relaxs)/wFREEPAGE_SIZE + 1)

RESERVE(FLS_GAPS_FLAG, 1)
RESERVE(FLS_GAPS, sizeof(gaps)/wFREEPAGE_SIZE + 1)

RESERVE(FLS_DECRET, 1)

RESERVE(FLS_TRANS_ENG, REALCAN_PAGES)
RESERVE(FLS_TRANS_CNT, REALCAN_PAGES)
RESERVE(FLS_PULSE_HOU, REALCAN_PAGES)
RESERVE(FLS_PULSE_MNT, REALCAN_PAGES)

RESERVE(FLS_COUNT, REALCAN_PAGES)
RESERVE(FLS_LOSSE, REALCAN_PAGES)
RESERVE(FLS_LEVEL, REALCAN_PAGES)

RESERVE(FLS_IMPMNTCAN, bMINUTES)
RESERVE(FLS_IMPHOUCAN, IMPHOUCAN_PAGES)

RESERVE(FLS_IMPDAYCAN, bIMPULSE_CAN*bDAYS)
RESERVE(FLS_IMPMONCAN, bIMPULSE_CAN*bMONTHS)
RESERVE(FLS_POWDAYGRP, bPOWER_GRP*bDAYS)
RESERVE(FLS_POWMONGRP, bPOWER_GRP*bMONTHS)
RESERVE(FLS_CNTMONCAN, REALCAN_PAGES*bMONTHS)

RESERVE(FLS_IMPHOUCAN_BUFF, 1)
RESERVE(FLS_IMPDAYCAN_BUFF, bIMPULSE_CAN)
RESERVE(FLS_IMPMONCAN_BUFF, bIMPULSE_CAN)
RESERVE(FLS_IMPABSCAN_BUFF, bIMPULSE_CAN)
RESERVE(FLS_POWDAYGRP_BUFF, bPOWER_GRP)
RESERVE(FLS_POWMONGRP_BUFF, bPOWER_GRP)
RESERVE(FLS_CNTMONCAN_BUFF, REALCAN_PAGES)

RESERVE(FLS_PTRMNT, 1)
RESERVE(FLS_PTRHOU, 1)
RESERVE(FLS_PTRDAY, 1)
RESERVE(FLS_PTRMON, 1)

RESERVE(FLS_REALTIME, 1)

RESERVE(FLS_MAJOR_IN_DELAY, 1)
RESERVE(FLS_MINOR_IN_DELAY, 1)

RESERVE(FLS_DIGITALS, sizeof(digital)*bCANALS/wFREEPAGE_SIZE + 1)
RESERVE(FLS_ENBL_CAN, 1)

RESERVE(FLS_ENBL_CURRENT, 1)
RESERVE(FLS_ENBL_PROFILE, 1)
RESERVE(FLS_TIMEOUT_CURRENT, 1)
RESERVE(FLS_TIMEOUT_PROFILE, 1)

END(FLS_END)
} flash;



#endif
